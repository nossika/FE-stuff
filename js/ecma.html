<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>JS(ECMA) | 前端工程师的自我修养</title><meta name="description" content="前端工程师的自我修养">
    <link rel="preload" href="/FE-stuff/assets/style-4f4e7070.css" as="style"><link rel="stylesheet" href="/FE-stuff/assets/style-4f4e7070.css">
    <link rel="modulepreload" href="/FE-stuff/assets/app-526fbdf6.js"><link rel="modulepreload" href="/FE-stuff/assets/framework-5866ffd3.js"><link rel="modulepreload" href="/FE-stuff/assets/ecma.html-802e3bba.js"><link rel="modulepreload" href="/FE-stuff/assets/ecma.html-97c21bf0.js"><link rel="prefetch" href="/FE-stuff/assets/index.html-ee20b8c6.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/application.html-e6da3c43.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/structure.html-b237058b.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/topic.html-f2e485ab.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/concept.html-bcb8ef5b.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/design.html-4dc477ed.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/lang.html-6f9c2d53.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/paradigm.html-6c6197d5.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/build.html-7b2684db.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/coop.html-6ae24f5e.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/deploy.html-af15072d.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/devops.html-96cc75ba.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/module.html-c48fa5e6.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/monitor.html-34fda7d7.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/test.html-ad74553b.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/react-vs-vue.html-a4aaee36.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/react.html-16efdf32.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/vue.html-dcd9d7b8.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/diff-js.html-40618d68.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/main.html-c994b437.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/css.html-d8866953.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/html.html-67c45bad.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/dom.html-0f4b213c.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/engine.html-dc564d25.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/examination.html-d7cd5f1d.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/thread.html-4df29bc0.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/api.html-b0199556.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/app.html-1901d566.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/dep.html-aa57c0f5.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/loop.html-502140e2.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/npm.html-22b58093.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/database.html-48518207.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/docker.html-144682db.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/electron.html-2bb1a3d1.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/graphql.html-488fef20.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/linux.html-7e709d95.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/nginx.html-fcec80ce.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/pwa.html-668203b5.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/rxjs.html-93df6ab3.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/webassembly.html-c06e4c08.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/analysis.html-b6c5dc5a.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/render.html-c6adac69.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/main.html-c4ada043.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/auth.html-0af225d7.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/cache.html-9a5d1a9c.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/cdn.html-af36fb79.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/communication.html-2d0a6138.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/protocol.html-c79e2d74.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/security.html-19c3b0af.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/index.html-7e47a83d.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/application.html-5e3f9414.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/structure.html-daf74f40.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/topic.html-b158b192.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/concept.html-9e2e9727.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/design.html-007acdfc.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/lang.html-db6dfc38.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/paradigm.html-200010d0.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/build.html-71d78d22.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/coop.html-5612a669.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/deploy.html-a8fbb073.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/devops.html-7194755e.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/module.html-09c503ed.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/monitor.html-ebdfdf3f.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/test.html-35c7bcff.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/react-vs-vue.html-b0edf048.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/react.html-e808fcaf.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/vue.html-fb4c602a.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/diff-js.html-02bbf445.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/main.html-cac7a75a.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/css.html-daddb0bf.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/html.html-a98cd3b1.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/dom.html-7c6c6837.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/engine.html-8a0f8044.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/examination.html-d0c9851f.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/thread.html-b0083c06.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/api.html-55ee59c7.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/app.html-a3ee9560.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/dep.html-c119e088.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/loop.html-2817c6d3.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/npm.html-3f366170.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/database.html-9dc6726a.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/docker.html-41ac3d09.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/electron.html-5bb6572c.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/graphql.html-a9cdc19b.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/linux.html-062c72f4.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/nginx.html-e0c6bde4.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/pwa.html-072c200d.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/rxjs.html-c44689ce.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/webassembly.html-6efa266f.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/analysis.html-da23ee8a.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/render.html-c0be1dee.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/main.html-b855c5f8.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/auth.html-dc27865a.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/cache.html-145181a2.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/cdn.html-8f8dcf1f.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/communication.html-b297bc7f.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/protocol.html-ad5147f5.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/security.html-2e702923.js" as="script"><link rel="prefetch" href="/FE-stuff/assets/404.html-87d54bd8.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/FE-stuff/" class=""><!----><span class="site-name">前端工程师的自我修养</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/nossika/FE-stuff" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/nossika/FE-stuff" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">JS <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/FE-stuff/js/ecma.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="JS(ECMA)"><!--[--><!--]--> JS(ECMA) <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/FE-stuff/js/ecma.html#js-和-ecma-的关系" class="router-link-active router-link-exact-active sidebar-item" aria-label="JS 和 ECMA 的关系"><!--[--><!--]--> JS 和 ECMA 的关系 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#类型转换" class="router-link-active router-link-exact-active sidebar-item" aria-label="类型转换"><!--[--><!--]--> 类型转换 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/FE-stuff/js/ecma.html#数字转字符串" class="router-link-active router-link-exact-active sidebar-item" aria-label="数字转字符串"><!--[--><!--]--> 数字转字符串 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#字符串转数字" class="router-link-active router-link-exact-active sidebar-item" aria-label="字符串转数字"><!--[--><!--]--> 字符串转数字 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#对基本类型的属性读写" class="router-link-active router-link-exact-active sidebar-item" aria-label="对基本类型的属性读写"><!--[--><!--]--> 对基本类型的属性读写 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#类型的隐式转换" class="router-link-active router-link-exact-active sidebar-item" aria-label="类型的隐式转换"><!--[--><!--]--> 类型的隐式转换 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#数字精度问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="数字精度问题"><!--[--><!--]--> 数字精度问题 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/FE-stuff/js/ecma.html#ieee-754" class="router-link-active router-link-exact-active sidebar-item" aria-label="IEEE-754"><!--[--><!--]--> IEEE-754 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#底层存储" class="router-link-active router-link-exact-active sidebar-item" aria-label="底层存储"><!--[--><!--]--> 底层存储 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#为何-0-1-本身不精确-还能正常显示-0-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="为何 0.1 本身不精确，还能正常显示 0.1？"><!--[--><!--]--> 为何 0.1 本身不精确，还能正常显示 0.1？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#上面-toprecision-16-的-16-是哪来的" class="router-link-active router-link-exact-active sidebar-item" aria-label="上面 toPrecision(16) 的 16 是哪来的？"><!--[--><!--]--> 上面 toPrecision(16) 的 16 是哪来的？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#为什么最大安全整数是-9007199254740991" class="router-link-active router-link-exact-active sidebar-item" aria-label="为什么最大安全整数是 9007199254740991？"><!--[--><!--]--> 为什么最大安全整数是 9007199254740991？ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#array" class="router-link-active router-link-exact-active sidebar-item" aria-label="Array"><!--[--><!--]--> Array <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/FE-stuff/js/ecma.html#原型方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="原型方法"><!--[--><!--]--> 原型方法 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#object" class="router-link-active router-link-exact-active sidebar-item" aria-label="Object"><!--[--><!--]--> Object <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/FE-stuff/js/ecma.html#禁止修改属性" class="router-link-active router-link-exact-active sidebar-item" aria-label="禁止修改属性"><!--[--><!--]--> 禁止修改属性 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#对象属性遍历" class="router-link-active router-link-exact-active sidebar-item" aria-label="对象属性遍历"><!--[--><!--]--> 对象属性遍历 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#原型-继承" class="router-link-active router-link-exact-active sidebar-item" aria-label="原型/继承"><!--[--><!--]--> 原型/继承 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/FE-stuff/js/ecma.html#原型的意义" class="router-link-active router-link-exact-active sidebar-item" aria-label="原型的意义"><!--[--><!--]--> 原型的意义 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#原型继承和类继承" class="router-link-active router-link-exact-active sidebar-item" aria-label="原型继承和类继承"><!--[--><!--]--> 原型继承和类继承 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#原型、实例、构造函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="原型、实例、构造函数"><!--[--><!--]--> 原型、实例、构造函数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#原型链" class="router-link-active router-link-exact-active sidebar-item" aria-label="原型链"><!--[--><!--]--> 原型链 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#继承方式" class="router-link-active router-link-exact-active sidebar-item" aria-label="继承方式"><!--[--><!--]--> 继承方式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#一个instanceof问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="一个instanceof问题"><!--[--><!--]--> 一个instanceof问题 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#作用域" class="router-link-active router-link-exact-active sidebar-item" aria-label="作用域"><!--[--><!--]--> 作用域 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/FE-stuff/js/ecma.html#作用域链" class="router-link-active router-link-exact-active sidebar-item" aria-label="作用域链"><!--[--><!--]--> 作用域链 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#闭包" class="router-link-active router-link-exact-active sidebar-item" aria-label="闭包"><!--[--><!--]--> 闭包 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/FE-stuff/js/ecma.html#栈内存、堆内存" class="router-link-active router-link-exact-active sidebar-item" aria-label="栈内存、堆内存"><!--[--><!--]--> 栈内存、堆内存 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#异步" class="router-link-active router-link-exact-active sidebar-item" aria-label="异步"><!--[--><!--]--> 异步 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/FE-stuff/js/ecma.html#promise" class="router-link-active router-link-exact-active sidebar-item" aria-label="Promise"><!--[--><!--]--> Promise <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#async-await" class="router-link-active router-link-exact-active sidebar-item" aria-label="async/await"><!--[--><!--]--> async/await <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#模块化" class="router-link-active router-link-exact-active sidebar-item" aria-label="模块化"><!--[--><!--]--> 模块化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#尾调用-tail-call" class="router-link-active router-link-exact-active sidebar-item" aria-label="尾调用（Tail Call）"><!--[--><!--]--> 尾调用（Tail Call） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#weakmap-weakset" class="router-link-active router-link-exact-active sidebar-item" aria-label="WeakMap/WeakSet"><!--[--><!--]--> WeakMap/WeakSet <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#with-语法" class="router-link-active router-link-exact-active sidebar-item" aria-label="with 语法"><!--[--><!--]--> with 语法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/FE-stuff/js/ecma.html#对象拷贝" class="router-link-active router-link-exact-active sidebar-item" aria-label="对象拷贝"><!--[--><!--]--> 对象拷贝 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/FE-stuff/js/dom.html" class="sidebar-item" aria-label="JS(DOM/BOM)"><!--[--><!--]--> JS(DOM/BOM) <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/js/engine.html" class="sidebar-item" aria-label="V8 引擎"><!--[--><!--]--> V8 引擎 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/js/thread.html" class="sidebar-item" aria-label="单线程的JS"><!--[--><!--]--> 单线程的JS <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/js/examination.html" class="sidebar-item" aria-label="笔试题"><!--[--><!--]--> 笔试题 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">HTML/CSS <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/FE-stuff/htmlcss/html.html" class="sidebar-item" aria-label="HTML"><!--[--><!--]--> HTML <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/htmlcss/css.html" class="sidebar-item" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">WEB <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/FE-stuff/web/protocol.html" class="sidebar-item" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/web/cache.html" class="sidebar-item" aria-label="缓存"><!--[--><!--]--> 缓存 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/web/security.html" class="sidebar-item" aria-label="安全"><!--[--><!--]--> 安全 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/web/cdn.html" class="sidebar-item" aria-label="CDN"><!--[--><!--]--> CDN <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/web/auth.html" class="sidebar-item" aria-label="登录 &amp; 身份验证"><!--[--><!--]--> 登录 &amp; 身份验证 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/web/communication.html" class="sidebar-item" aria-label="通信"><!--[--><!--]--> 通信 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">性能 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/FE-stuff/performance/render.html" class="sidebar-item" aria-label="浏览器渲染"><!--[--><!--]--> 浏览器渲染 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/performance/analysis.html" class="sidebar-item" aria-label="性能优化"><!--[--><!--]--> 性能优化 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">框架 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/FE-stuff/framework/react.html" class="sidebar-item" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/framework/vue.html" class="sidebar-item" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/framework/react-vs-vue.html" class="sidebar-item" aria-label="React VS Vue"><!--[--><!--]--> React VS Vue <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">算法 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/FE-stuff/algorithm/structure.html" class="sidebar-item" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/algorithm/topic.html" class="sidebar-item" aria-label="算法题"><!--[--><!--]--> 算法题 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/algorithm/application.html" class="sidebar-item" aria-label="应用"><!--[--><!--]--> 应用 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">计算机科学 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/FE-stuff/cs/concept.html" class="sidebar-item" aria-label="概念"><!--[--><!--]--> 概念 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/cs/lang.html" class="sidebar-item" aria-label="编程语言"><!--[--><!--]--> 编程语言 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/cs/paradigm.html" class="sidebar-item" aria-label="编程范式"><!--[--><!--]--> 编程范式 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/cs/design.html" class="sidebar-item" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">工程化 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/FE-stuff/engineer/module.html" class="sidebar-item" aria-label="模块化"><!--[--><!--]--> 模块化 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/engineer/build.html" class="sidebar-item" aria-label="构建"><!--[--><!--]--> 构建 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/engineer/coop.html" class="sidebar-item" aria-label="协作"><!--[--><!--]--> 协作 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/engineer/test.html" class="sidebar-item" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/engineer/deploy.html" class="sidebar-item" aria-label="部署"><!--[--><!--]--> 部署 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/engineer/monitor.html" class="sidebar-item" aria-label="监控"><!--[--><!--]--> 监控 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/engineer/devops.html" class="sidebar-item" aria-label="DevOps"><!--[--><!--]--> DevOps <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">NodeJS <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/FE-stuff/node/loop.html" class="sidebar-item" aria-label="事件循环"><!--[--><!--]--> 事件循环 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/node/dep.html" class="sidebar-item" aria-label="依赖管理"><!--[--><!--]--> 依赖管理 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/node/api.html" class="sidebar-item" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/node/npm.html" class="sidebar-item" aria-label="NPM"><!--[--><!--]--> NPM <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">GoLang <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/FE-stuff/go/main.html" class="sidebar-item" aria-label="一些用法"><!--[--><!--]--> 一些用法 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/go/diff-js.html" class="sidebar-item" aria-label="和JS对比"><!--[--><!--]--> 和JS对比 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Python <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/FE-stuff/py/main.html" class="sidebar-item" aria-label="一些用法"><!--[--><!--]--> 一些用法 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">其他 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/FE-stuff/others/electron.html" class="sidebar-item" aria-label="Electron"><!--[--><!--]--> Electron <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/others/pwa.html" class="sidebar-item" aria-label="PWA"><!--[--><!--]--> PWA <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/others/graphql.html" class="sidebar-item" aria-label="GraphQL"><!--[--><!--]--> GraphQL <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/others/rxjs.html" class="sidebar-item" aria-label="RxJS"><!--[--><!--]--> RxJS <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/others/webassembly.html" class="sidebar-item" aria-label="WebAssembly"><!--[--><!--]--> WebAssembly <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/others/docker.html" class="sidebar-item" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/others/database.html" class="sidebar-item" aria-label="数据库"><!--[--><!--]--> 数据库 <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/others/nginx.html" class="sidebar-item" aria-label="nginx"><!--[--><!--]--> nginx <!--[--><!--]--></a><!----></li><li><a href="/FE-stuff/others/linux.html" class="sidebar-item" aria-label="linux"><!--[--><!--]--> linux <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="js-ecma" tabindex="-1"><a class="header-anchor" href="#js-ecma" aria-hidden="true">#</a> JS(ECMA)</h1><h2 id="js-和-ecma-的关系" tabindex="-1"><a class="header-anchor" href="#js-和-ecma-的关系" aria-hidden="true">#</a> JS 和 ECMA 的关系</h2><p>European Computer Manufacturers Association（ECMA）是一个制定计算机标准的机构。<a href="https://tc39.es/ecma262/" target="_blank" rel="noopener noreferrer">ECMAScript（ECMA-262）<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 是 ECMA 制定的一种编程语言规范，有跨平台特性。此规范主要由 TC39 团队维护。</p><p>JavaScript（JS） 是 ECMAScript 的一种实现，广义的 JS 除了遵循 ECMAScript 标准之外，还基于平台特性提供一些额外 API，比如在浏览器内的 JS 有 DOM 操作相关的 API。</p><p>此章仅讨论 ECMAScript 标准下的 JS，不包括平台相关的特性。</p><h2 id="类型转换" tabindex="-1"><a class="header-anchor" href="#类型转换" aria-hidden="true">#</a> 类型转换</h2><h3 id="数字转字符串" tabindex="-1"><a class="header-anchor" href="#数字转字符串" aria-hidden="true">#</a> 数字转字符串</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">1</span> <span class="token operator">+</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span> <span class="token comment">// &#39;1&#39;</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#39;1&#39;</span>
<span class="token function">String</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#39;1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="字符串转数字" tabindex="-1"><a class="header-anchor" href="#字符串转数字" aria-hidden="true">#</a> 字符串转数字</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">+</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
Number<span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token function">Number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="对基本类型的属性读写" tabindex="-1"><a class="header-anchor" href="#对基本类型的属性读写" aria-hidden="true">#</a> 对基本类型的属性读写</h3><p>我们可以直接对某个基本类型调用方法，比如<code>&#39;string&#39;.indexOf(&#39;s&#39;)</code>。</p><p>JS 引擎在编译阶段，如果发现有对基本类型的属性读取，则会先将其包装为对应的对象再执行，比如：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token string">&#39;asd&#39;</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;s&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token comment">// equal to</span>
<span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&#39;asd&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;s&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token class-name">Number</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>asd <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asd<span class="token punctuation">;</span> <span class="token comment">// 123</span>
<span class="token comment">// equal to</span>
<span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asd<span class="token punctuation">;</span> <span class="token comment">// 123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但如果是对属性的写入，则无效，但也不报错：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">&#39;asd&#39;</span><span class="token punctuation">;</span>
str<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token string">&#39;f&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 写入失败，但不报错</span>
str<span class="token punctuation">.</span>prop<span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="类型的隐式转换" tabindex="-1"><a class="header-anchor" href="#类型的隐式转换" aria-hidden="true">#</a> 类型的隐式转换</h3><p>每个类型的数据都有一个内部的<code>[Symbol.toPrimitive]</code>方法，当需要对数据类型隐式转换时会调用它。</p><p>此方法接收一个<code>hint</code>参数，即<code>[Symbol.toPrimitive](hint)</code>，运行时根据上下文自动按规则决定 hint 取值（string/number/default）。</p><p>内置的<code>[Symbol.toPrimitive](hint)</code>调用流程如下：</p><ul><li><p>string 场景: try <code>data.toString()</code> -&gt; try <code>data.valueOf()</code> -&gt; throw error</p></li><li><p>number/default场景: try <code>data.valueOf()</code> -&gt; try <code>data.String()</code> -&gt; throw error</p></li></ul><p>也可以对<code>[Symbol.toPrimitive]</code>进行改写，搬运一个MDN上的例子：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// An object without Symbol.toPrimitive property.</span>
<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// NaN</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>obj1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;[object Object]&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1 <span class="token operator">+</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;[object Object]&quot;</span>

<span class="token comment">// An object with Symbol.toPrimitive property.</span>
<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token parameter">hint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&#39;number&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 10        -- hint is &quot;number&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>obj2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;hello&quot;   -- hint is &quot;string&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2 <span class="token operator">+</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;true&quot;    -- hint is &quot;default&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="数字精度问题" tabindex="-1"><a class="header-anchor" href="#数字精度问题" aria-hidden="true">#</a> 数字精度问题</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">0.1</span><span class="token punctuation">;</span> <span class="token comment">// 0.1</span>
<span class="token number">0.2</span><span class="token punctuation">;</span> <span class="token comment">// 0.2</span>
<span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">;</span> <span class="token comment">// 0.30000000000000004</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>0.1 + 0.2 的结果为何不是 0.3?</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token number">9007199254740992</span> <span class="token operator">===</span> <span class="token number">9007199254740993</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>为什么 9007199254740992 等于 9007199254740993？</p><h3 id="ieee-754" tabindex="-1"><a class="header-anchor" href="#ieee-754" aria-hidden="true">#</a> IEEE-754</h3><p>JS 会将能转换成整数的数据都以整数存储。对于小数，使用的是 <a href="https://zh.wikipedia.org/wiki/IEEE_754" target="_blank" rel="noopener noreferrer"><strong>IEEE-754</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 标准，其底层是用双精度（64 位）浮点数来存储。</p><p>此问题是由底层存储结构带来，用固定空间来存储无限的数字，必定有精度丢失，所有使用 IEEE-754 处理浮点数的语言都有此问题。</p><h3 id="底层存储" tabindex="-1"><a class="header-anchor" href="#底层存储" aria-hidden="true">#</a> 底层存储</h3><p>64 位浮点数的组成：1 符号位 + 11 指数位 + 52 有效数字位。</p><p>如何用 0 和 1 表示小数？对于小数 x，其以二进制表示的方式为：把 x 分解成<code>x = 1/2 * n1 + 1/4 * n2 + 1/8 * n3 + 1/16 * n4 + ...</code>，用其中的 n1n2n3n4... 等因子来作为二进制数字。</p><p>以小数 0.1 为例，<code>0.1 = 1/2 * 0 + 1/4 * 0 + 1/8 * 0 + 1/16 * 1 + 1/32 * 1 + 1/64 * 0 + ...</code> ，则 0.1 的二进制表示为 00011001100...，去掉头部 0，从 1 开始算（头部的 0 有多少可以在指数位表示），则有效数字为 11001100...</p><p>因此大部分小数无法精确存储，除了 0.5/0.125/0.375 这类数字（有效数字刚好有限）。</p><p>回到开头的例子，因为 0.1 和 0.2 本身就不是精确的 0.1 和 0.2，所以他们相加的结果也不是精确的 0.3。</p><h3 id="为何-0-1-本身不精确-还能正常显示-0-1" tabindex="-1"><a class="header-anchor" href="#为何-0-1-本身不精确-还能正常显示-0-1" aria-hidden="true">#</a> 为何 0.1 本身不精确，还能正常显示 0.1？</h3><p>因为 JS 做了自动凑整处理：toPrecision(16)。</p><p>如果执行<code>(0.1).toPrecision(20)</code>，实际得到的不是 0.1，而是 0.10000000000000000555。</p><h3 id="上面-toprecision-16-的-16-是哪来的" tabindex="-1"><a class="header-anchor" href="#上面-toprecision-16-的-16-是哪来的" aria-hidden="true">#</a> 上面 toPrecision(16) 的 16 是哪来的？</h3><p>因为有效数字部分能显示的最大数字<code>Number.MAX_SAFE_INTEGER</code>是 9007199254740991 ，即十进制下的 16 位有效数字，超过这个精度的部分会被舍去。所以 0.1 实际存储的二进制再翻译回来就是 0.1000000000000000，把尾部的连续 0 凑整后就是 0.1。</p><p>那么如何判断 0.1 + 0.2 === 0.3 呢？JS 可用的最小精度（JS 可准确表示的最小浮点数）是<code>Number.EPSILON</code>，如果 0.1 + 0.2 和 0.3 的差值小于<code>Number.EPSILON</code>，则可以认为两者相等。</p><h3 id="为什么最大安全整数是-9007199254740991" tabindex="-1"><a class="header-anchor" href="#为什么最大安全整数是-9007199254740991" aria-hidden="true">#</a> 为什么最大安全整数是 9007199254740991？</h3><p>因为有效数字位为 52 位，加上开头省略的隐藏位（能通过规则反推），总共能有 53 位。而数字是从 0 而非 1 开始的，0 ～ 9007199254740991(2^53-1) 总共正好是 2^53 个数。</p><p>在这个范围内的数字，底层能以唯一对应的数据存储，数字更大的话，则可能有多个数字对应同样的存储数据（比如开头例子中的 9007199254740992 和 9007199254740993），所以无法精确表示，只能近似把它 round 到一个附近的数。</p><p>可以用<code>Number.isSafeInteger(num)</code>判断数字是否为安全整数。</p><h2 id="array" tabindex="-1"><a class="header-anchor" href="#array" aria-hidden="true">#</a> Array</h2><h3 id="原型方法" tabindex="-1"><a class="header-anchor" href="#原型方法" aria-hidden="true">#</a> 原型方法</h3><p>修改原数组：push / pop / shift / unshift / splice / sort / reverse</p><p>返回新数组：slice / map / filter / concat</p><p>数组遍历相关：forEach / map / filter / some / every / reduce / indexOf / find / includes</p><h2 id="object" tabindex="-1"><a class="header-anchor" href="#object" aria-hidden="true">#</a> Object</h2><h3 id="禁止修改属性" tabindex="-1"><a class="header-anchor" href="#禁止修改属性" aria-hidden="true">#</a> 禁止修改属性</h3><p>Object.freeze(obj)</p><blockquote><p>Object.seal(obj)：同样禁止增删属性，但允许修改现有属性</p></blockquote><p>Reflect.defineProperty(obj, &#39;prop&#39;, { writable: false })</p><p>Reflect.defineProperty(obj, &#39;prop&#39;, { set() {} })</p><h3 id="对象属性遍历" tabindex="-1"><a class="header-anchor" href="#对象属性遍历" aria-hidden="true">#</a> 对象属性遍历</h3><ul><li><p>Object.keys(obj) --- 返回obj实例上的<strong>可枚举属性</strong>名数组</p></li><li><p>Object.getOwnPropertyNames(obj) --- 返回obj实例上的<strong>所有属性名</strong>数组（除了Symbol属性，它们需要通过Object.getOwnPropertySymbols(obj)获取）</p></li><li><p>for (let prop in obj) { ... } --- 遍历obj实例以及<strong>其原型链</strong>上所有可枚举属性</p></li></ul><h2 id="原型-继承" tabindex="-1"><a class="header-anchor" href="#原型-继承" aria-hidden="true">#</a> 原型/继承</h2><h3 id="原型的意义" tabindex="-1"><a class="header-anchor" href="#原型的意义" aria-hidden="true">#</a> 原型的意义</h3><p>假设有些对象都需要有同一个方法fn，要生成n个此类对象。如果每一次都创建一个新的fn给对象，则这个fn需要n份的内存，以后也不方便统一修改；如果创建一个共用的原型，在原型上定义fn，然后把对象和此原型关联起来（此过程也叫继承），则这个fn只需要1份内存，就能让这类对象都拥有这个fn，对原型所做的修改也能让这类对象共享，便于节省空间、统一管理。</p><h3 id="原型继承和类继承" tabindex="-1"><a class="header-anchor" href="#原型继承和类继承" aria-hidden="true">#</a> 原型继承和类继承</h3><p>传统的类继承，需要通过类来创建对象（如JAVA）。</p><p>JS里可以直接创建对象，再设置对象的原型实现继承我，原型只是对象在运行时的一个字段，可以随时被修改，原型继承更加灵活。</p><h3 id="原型、实例、构造函数" tabindex="-1"><a class="header-anchor" href="#原型、实例、构造函数" aria-hidden="true">#</a> 原型、实例、构造函数</h3><p>每个构造函数（constructor）都有一个对应的原型对象（prototype），这个原型对象也包含着指向构造函数的指针，由构造函数生成的每个实例（instance）都包含一个指向原型对象的指针。</p><p>原型、实例、构造函数例子：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 构造函数 constructor</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实例 instance</span>

<span class="token keyword">const</span> protoA <span class="token operator">=</span> <span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// 原型 prototype</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>三者相互访问:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">===</span> protoA
<span class="token class-name">A</span><span class="token punctuation">.</span>prototype <span class="token operator">===</span> protoA

proto<span class="token punctuation">.</span>constructor <span class="token operator">===</span> <span class="token constant">A</span>
a<span class="token punctuation">.</span>constructor <span class="token operator">===</span> <span class="token constant">A</span> <span class="token comment">// 实际上等同于 a.__proto__.constructor</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/FE-stuff/assets/prototype-6e6116ed.png" alt="prototype"></p><h3 id="原型链" tabindex="-1"><a class="header-anchor" href="#原型链" aria-hidden="true">#</a> 原型链</h3><p>对象内有一个指向原型的指针，指向的这个原型同样也有一个指针（[[Prototype]]）指向它自己的原型，原型继续指向下一个原型，直到顶层，这一串原型称为对象的原型链，原型链的最顶层指向null。对象（obj）的原型可以通过标准方法<code>Object.getPrototypeOf(obj)</code>得到，或者浏览器厂商约定俗成的<code>obj.__proto__</code>。</p><p>访问一个对象（obj）上的属性（prop）时，首先会在这个对象本身搜寻此prop；若找不到，则会沿着obj的原型链往上查找此prop，若找到则返回，找不到则继续沿着原型链往上查找；若直到原型链顶部（null）都找不到，才会返回undefined。</p><h3 id="继承方式" tabindex="-1"><a class="header-anchor" href="#继承方式" aria-hidden="true">#</a> 继承方式</h3><h4 id="组合继承" tabindex="-1"><a class="header-anchor" href="#组合继承" aria-hidden="true">#</a> 组合继承</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 定义</span>
<span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;A&#39;</span> 
<span class="token punctuation">}</span>
<span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">hi</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hi&#39;</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">B</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// B继承A</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成实例b</span>

<span class="token comment">// 测试</span>
b<span class="token punctuation">.</span><span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// print &#39;hi&#39; （继承到了A的方法）</span>
b<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// A （也继承到了A中this定义的属性，但name属性是定义在a中，b通过原型链找到a，从而访问a.name）</span>
b<span class="token punctuation">.</span>constructor<span class="token punctuation">;</span> <span class="token comment">// A （但构造函数指向A ）</span>

<span class="token comment">// 原型链如下</span>
b<span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span> <span class="token comment">// a（constructor和__proto__都指向A）</span>
b<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span> <span class="token comment">// A.prototype</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>改变一下执行顺序</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 定义</span>
<span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;A&#39;</span> 
<span class="token punctuation">}</span>
<span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">hi</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hi&#39;</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在继承前生成生成实例b</span>
<span class="token class-name">B</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// B继承A</span>

<span class="token comment">// 测试</span>
b<span class="token punctuation">.</span><span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throw error （没有继承到A的方法）</span>
b<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// undefined</span>
b<span class="token punctuation">.</span>constructor<span class="token punctuation">;</span> <span class="token comment">// B （构造函数正确）</span>

<span class="token comment">// 原型链如下</span>
b<span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span> <span class="token comment">// 原B.prototype (即prototype指向被改写之前的那个对象)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="寄生组合继承" tabindex="-1"><a class="header-anchor" href="#寄生组合继承" aria-hidden="true">#</a> 寄生组合继承</h4><p>相比于组合继承：省去了一次A的实例化，也去除了B原型上不必要的字段（比如A实例化后的name字段），原型链更加干净。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">hi</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hi &#39;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token constant">B</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">inherit</span><span class="token punctuation">(</span><span class="token parameter">subClass<span class="token punctuation">,</span> protoClass</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  subClass<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>protoClass<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
  subClass<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> subClass<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">inherit</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

b <span class="token keyword">instanceof</span> <span class="token class-name">B</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
b<span class="token punctuation">.</span><span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//hi b</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="es6-class" tabindex="-1"><a class="header-anchor" href="#es6-class" aria-hidden="true">#</a> ES6 class</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 定义</span>
<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span> 
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;A&#39;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hi&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 测试</span>
b<span class="token punctuation">.</span><span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// print &#39;hi&#39; （继承到了A的方法）</span>
b<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// A （name直接定义在b上，即b.hasOwnProperty(&#39;name&#39;)为true）</span>
b<span class="token punctuation">.</span>constructor<span class="token punctuation">;</span> <span class="token comment">// B （构造函数也正确）</span>

<span class="token comment">// 原型链如下</span>
b<span class="token punctuation">.</span>__proto__ <span class="token comment">// B.prototype（constructor指向B、但__proto__指向A的一个对象）</span>
b<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__ <span class="token comment">// A.prototype</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="create写法" tabindex="-1"><a class="header-anchor" href="#create写法" aria-hidden="true">#</a> create写法</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> o <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>proto<span class="token punctuation">)</span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span> <span class="token comment">// proto</span>

<span class="token comment">// 创建一个纯净的对象，实例和原型上都没有任何key，可用来做map存储</span>
<span class="token keyword">const</span> pureObj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="一个instanceof问题" tabindex="-1"><a class="header-anchor" href="#一个instanceof问题" aria-hidden="true">#</a> 一个instanceof问题</h3><h4 id="为什么-object-instanceof-function-和-function-instanceof-object-都返回true" tabindex="-1"><a class="header-anchor" href="#为什么-object-instanceof-function-和-function-instanceof-object-都返回true" aria-hidden="true">#</a> 为什么 <code>Object instanceof Function</code> 和 <code>Function instanceof Object</code> 都返回true</h4><p>首先理解一下<code>instanceof</code>这个操作符，它会沿着前者的原型链（<code>__proto__</code>链）寻找是否满足与后者<code>prototype</code>相同的祖先，若找到就返回true，若一直到<code>__proto__</code>链遍历完还是没找到就返回false。</p><p>最简单的例子</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a <span class="token keyword">instanceof</span> <span class="token class-name">A</span> <span class="token comment">// 按上述查法，找到a.__proto__等于A.prototype，查找结束，返回true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要知道的几个知识：</p><ol><li>实例的<code>__proto__</code>等于其构造函数的<code>prototype</code>；</li><li>所有函数都是<code>Function</code>的实例，包括<code>Function</code>这个函数自身；</li><li>构造函数的<code>prototype</code>是一个普通对象，自然也是<code>Object</code>的实例。</li></ol><p>现在来看下问题中的<code>Object instanceof Function</code>：</p><p>根据知识2，<code>Object</code>自身虽然是一个构造函数，但也是函数，是<code>Function</code>的实例，再根据知识1得出<code>Object.__proto__</code>等于<code>Function.prototype</code>，返回结果true。</p><p>再看<code>Function instanceof Object</code>：</p><p>由知识2我们知道，<code>Function</code>是构造函数<code>Function</code>的实例，所以根据知识1知道<code>Function.__proto__</code>等于<code>Function.prototype</code>；结合知识1和3，知道<code>Function.prototype.__proto__</code>等于<code>Object.prototype</code>。当沿着<code>Function</code>原型链查找到<code>Function.__proto__.__proto__</code>，也就是<code>Function.prototype.__proto__</code>，它等于<code>Object.prototype</code>，所以也返回true。</p><h2 id="作用域" tabindex="-1"><a class="header-anchor" href="#作用域" aria-hidden="true">#</a> 作用域</h2><p>作用域（scope）即<strong>隔离变量</strong>的一块区域。在JS中分为块级作用域、函数作用域、全局作用域。</p><p>作用域可以用树状结构表示，比如如下例子：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>
<span class="token comment">// ...</span>

<span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">function</span> <span class="token constant">B1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">function</span> <span class="token constant">C1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token constant">C2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token constant">B2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token constant">B3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>它的作用域如图：</p><p><img src="/FE-stuff/assets/scope-0e2146a6.png" alt="scope"></p><h3 id="作用域链" tabindex="-1"><a class="header-anchor" href="#作用域链" aria-hidden="true">#</a> 作用域链</h3><p>作用域可以沿着它的父作用域、父父作用域一直往上追溯到全局作用域，这条链路称为<strong>作用域链</strong>。在一个作用域中使用了变量时，会优先查找本作用域中的此变量，如果没有则会沿着它的作用域链去查找，一直到全局作用域。作用域只能向祖先访问，无法直接访问其兄弟或者子孙作用域中的变量。</p><p>比如上述例子中，可以在C1作用域中访问到B1、A、global中的变量，但无法直接访问C2、B2中的变量。</p><h2 id="闭包" tabindex="-1"><a class="header-anchor" href="#闭包" aria-hidden="true">#</a> 闭包</h2><p>闭包（closure）是<strong>一个函数以及其环境（函数内依赖的变量）的总称</strong>。即使这个函数离开了创建它的环境，依然可以在外部正确执行（正确访问到它依赖的变量），因为函数依赖的变量在函数创建时（编译/解释阶段）已确定，它们会被记录在函数作用域中随着函数一起被保留。</p><p>一般而言，一个函数A执行完毕后，A的内部变量也会被随之销毁。但如果函数A内部定义了一个函数B，且B在A执行完毕后<strong>仍是活跃状态</strong>（可被外部引用，比如『A返回B』、『把B定义为某个按钮的click回调』等情况），那么B内部引用到的变量（即使它们不在B中）也会跟着B一起被保留下来，而不会随着A被销毁。只有当B被释放后，这些变量才会随之释放。</p><p>可以利用这个性质来构造函数的私有变量：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// count只有在fnWithCounter内能访问，外部无法读取或修改</span>
  <span class="token keyword">function</span> <span class="token function">fnWithCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    count<span class="token operator">++</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;count: &#39;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> innerCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 这个innerCount与count不同的是，它在fnWithCounter每次执行都会重新创建和销毁，而count可以被持久保留</span>
    <span class="token comment">// do sth.</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> fnWithCounter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> fnWithCounter <span class="token operator">=</span> <span class="token function">getFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 此时getFn虽然执行完毕，但其内部创建的count变量和fnWithCounter函数一起被保留下来</span>

<span class="token function">fnWithCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fnWithCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fnWithCounter <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 如果执行了这句来释放函数，使原fnWithCounter指向的函数成为非活跃状态（无法从根被访问到），则垃圾回收器可能在下次回收时，释放此函数和其环境占用的内存。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="栈内存、堆内存" tabindex="-1"><a class="header-anchor" href="#栈内存、堆内存" aria-hidden="true">#</a> 栈内存、堆内存</h3><p>栈和堆原意是指某种数据结构，但在谈论存储时也用来指代存储空间。</p><p>栈内存一般认为是线性空间，随着函数的执行而创建，也随着函数退出而自动销毁；堆内存一般认为是大小不定的空间，不会随着函数的退出而销毁，需要手动清理（或者自动GC清理）。</p><p>JS函数执行过程中，对基本类型的定义会将其分配到栈内存，引用类型会分配到堆内存，栈内存中仅保留堆内存的指针。</p><p>发生闭包时上述行为有特殊处理，闭包引用的变量，即使是基本类型，也会分配到堆内存上。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// chrome控制台可以通过函数的[[Scopes]]查看Closure。</span>
<span class="token comment">// 可以看到返回的bar函数里，引用到了foo的a就纳入了其闭包环境，未引用到的b则不在其中。</span>
console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="异步" tabindex="-1"><a class="header-anchor" href="#异步" aria-hidden="true">#</a> 异步</h2><blockquote><p>此处只谈语法使用，原理相关详见<a href="/FE-stuff/js/thread.html#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF" class="">【事件循环（浏览器）】</a></p></blockquote><h3 id="promise" tabindex="-1"><a class="header-anchor" href="#promise" aria-hidden="true">#</a> Promise</h3><h4 id="promise-all-promise-race" tabindex="-1"><a class="header-anchor" href="#promise-all-promise-race" aria-hidden="true">#</a> Promise.all/Promise.race</h4><h4 id="promise错误处理" tabindex="-1"><a class="header-anchor" href="#promise错误处理" aria-hidden="true">#</a> Promise错误处理</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>无法捕获promise内部错误。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handler<span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>两者区别在于前者无法捕获handler函数内发生的错误，后者可以。</p><h3 id="async-await" tabindex="-1"><a class="header-anchor" href="#async-await" aria-hidden="true">#</a> async/await</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">asyncFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个promise，其resolve时机等于asyncFn内部代码（包括其await）执行完毕时</span>

<span class="token keyword">await</span> promise<span class="token punctuation">;</span> <span class="token comment">// 或者await一个非promise变量，等同于执行await Promise.resolve(val)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="模块化" tabindex="-1"><a class="header-anchor" href="#模块化" aria-hidden="true">#</a> 模块化</h2><p>在ES6之前，JS在语言层面并没有模块相关的规范，CommonJS和AMD是社区上较为主流的模块方案。</p><p>静态导入（ES6标准）：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> a <span class="token keyword">from</span> <span class="token string">&#39;./module-a&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>按相关标准，静态导入是会作用于编译阶段，在代码运行之前，所以import不能被包裹在if代码块内</p><p>动态导入（目前还处于提案阶段）：</p><p>作用于运行阶段，所以import后的路径可以是拼接的字符串</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./module-b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 得到一个promise</span>

b<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">content</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// module-b的内容content作为promise的结果返回</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>其他模块化方案详见<a href="/FE-stuff/engineer/module.html#%E6%A8%A1%E5%9D%97%E5%8C%96" class="">【模块化】</a></p></blockquote><h2 id="尾调用-tail-call" tabindex="-1"><a class="header-anchor" href="#尾调用-tail-call" aria-hidden="true">#</a> 尾调用（Tail Call）</h2><p>定义：函数的return结果是调用一个函数。</p><p>正常情况下函数内调用函数，在内存会有一个调用栈（Call Stack），来保存下各个函数的调用帧。</p><p>举个例子，有一个函数A，A内部调用了B，B内部又调用了C：</p><p><img src="/FE-stuff/assets/tail-call-5ec01566.png" alt="tail call"></p><p>一般情况下，函数A的调用栈如下：</p><ol><li>对A展开，发现其需要B的返回值，则在调用栈中记录A的调用帧，然后展开计算B</li><li>展开B发现其需要C的返回值，则调用栈也记录下B的调用帧，展开计算C</li><li>C返回结果后，调用栈弹出B的调用帧计算B</li><li>B返回结果后，调用栈弹出A的调用帧计算A</li><li>返回A的结果作为最终返回值，执行完毕</li></ol><p>在尾调用的情况下，A直接返回B的执行结果，B直接返回C的执行结果。则函数A的调用栈如下：</p><ol><li>对A展开，发现其直接返回B，则展开计算B，以B的返回值作为A的结果，不记录A</li><li>对B展开，发现其直接返回C，则展开计算C，以C的返回值作为B的结果，不记录B</li><li>展开计算C，以C的返回值作为最终返回值，执行完毕</li></ol><p>此特性一般可以在递归中作为优化手段，把普通递归改为尾调用（尾递归），可以节省大量内存。</p><p>斐波那契数例子：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 普通递归：fib(5) 展开为 fib(4) + fib(3)，其中 fib(4) 展开为 fib(3) + fib(2)，其中 fib(3) 展开为 fib(2) + fib(1)</span>
<span class="token comment">// 函数会一直展开，临时调用栈不断往上堆叠，直到最上层结果返回，再逐个往下求结果，最后拿到最下层的结果为函数执行结果</span>

<span class="token keyword">function</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> prev <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> cur <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> cur<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> cur<span class="token punctuation">,</span> cur <span class="token operator">+</span> prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 尾递归：fib(5) 替换为 fib(4, 1, 2) 替换为 fib(3, 2, 3) 替换为 fib(2, 3, 5) 替换为 fib(1, 5, 8)</span>
<span class="token comment">// 始终只需要保存最新一层调用帧，此调用帧结果即是函数执行结果</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>尾调用优化在支持ES6的环境中（严格模式下）默认开启。</p><h2 id="weakmap-weakset" tabindex="-1"><a class="header-anchor" href="#weakmap-weakset" aria-hidden="true">#</a> WeakMap/WeakSet</h2><p>es6 提供了一种特殊的 key-value 数据结构 WeakMap，其特点是不会对 key 造成引用，因而在垃圾回收时允许对 key 回收。</p><p>一个比较典型的例子是用于给 DOM 节点缓存数据：</p><p>Map 写法：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#title&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// el 变量引用 #title 这个 DOM 元素</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token string">&#39;some info&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 给 #title 加上自定义信息，map 对 #title 再次引用</span>
map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取 #title 的信息</span>
el <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// el 变量清空</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>后续如果 #title DOM 元素本身被删除，但 map 依然保留对它的引用，所以垃圾回收机制不会清理 #title 节点。</p><p>WeakMap 写法：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> weakMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#title&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// el 变量引用 #title 这个 DOM 元素</span>
weakMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token string">&#39;some info&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 给 #title 加上自定义信息，但 weakMap 对 #title 是弱引用</span>
weakMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取 #title 的信息</span>
el <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// el 变量清空</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>后续如果 #title DOM 元素本身被删除，而 weakMap 不计入对它的引用，其他地方也没有对它的引用，则垃圾回收机制会清理 #title 节点。</p><p>这也是 WeakMap 不可遍历的一个原因，因为它不保留对 key 的引用，内部的值可以随时被 GC 清除。</p><p>es2021 更进一步，提供了 <a href="https://github.com/tc39/proposal-weakrefs" target="_blank" rel="noopener noreferrer">WeakRef<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，可以对用于对任意对象的弱引用。</p><h2 id="with-语法" tabindex="-1"><a class="header-anchor" href="#with-语法" aria-hidden="true">#</a> with 语法</h2><p><code>with(source){prop}</code>被调用时：实际上会先调用<code>prop in source</code>，若返回 true，则<code>prop</code>取<code>source[prop]</code>的值；若false，则跳出 with 作用域继续往上查找，直到找到 prop 或者报错<code>prop is not defined</code>。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

proxy<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token keyword">with</span> <span class="token punctuation">(</span>proxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">;</span> <span class="token comment">// TypeError: a is not defined</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> proxy2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">has</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">has </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ?</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

proxy2<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token keyword">with</span> <span class="token punctuation">(</span>proxy2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 a<span class="token punctuation">;</span> <span class="token comment">// 打印出&#39;has a ?&#39;并且返回 1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="对象拷贝" tabindex="-1"><a class="header-anchor" href="#对象拷贝" aria-hidden="true">#</a> 对象拷贝</h2><p>JS 内的对象是引用类型，当一个对象需要被多个地方使用，但又不希望它们相互影响时，需要对对象作拷贝处理。</p><blockquote><p>Object.assign(newObj, obj) 可实现浅拷贝，只拷贝对象第一层。</p></blockquote><blockquote><p>JSON.parse(JSON.stringify(obj)) 可以实现简单的深拷贝，但会丢失除了基本类型以外的其他数据。</p></blockquote><p>深拷贝实现例子：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 未考虑循环引用，可增加一个 WeakMap 缓存原值对应的克隆值，优先从缓存取值使用</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 补充对 Set、Map 等其他w特殊类型的处理</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;[object Object]&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> copied <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 注意对对象的遍历方式，简单的 for in 会遍历到其原型上的属性</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 可根据 Object.getOwnPropertyDescriptor(data, key) 设置新值的 descriptor</span>
      copied<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> copied<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结构化克隆：</p><p>HTML5定义的概念。对象可能通过其他信道传递，对对象序列化，再解析。结构化克隆是浏览器的内置实现，可以保留除 Function、Symbol 外的，和上下文无关的全部类型的数据。</p><blockquote><p>参考文献 <a href="https://www.w3.org/TR/html5/infrastructure.html#safe-passing-of-structured-data" target="_blank" rel="noopener noreferrer">【Safe passing of structured data】<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><ul><li><p>window.postMessage</p></li><li><p>MessageChannel</p></li><li><p>history.pushState</p></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/nossika/FE-stuff/edit/master/js/ecma.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 476492581@qq.com">nossika</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: nossikalin@tencent.com">nossikalin</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/FE-stuff/js/dom.html" class="" aria-label="JS(DOM/BOM)"><!--[--><!--]--> JS(DOM/BOM) <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/FE-stuff/assets/app-526fbdf6.js" defer></script>
  </body>
</html>
