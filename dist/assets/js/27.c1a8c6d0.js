(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{425:function(a,t,e){"use strict";e.r(t);var v=e(54),_=Object(v.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"构建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[a._v("#")]),a._v(" 构建")]),a._v(" "),e("h2",{attrs:{id:"webpack"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#webpack"}},[a._v("#")]),a._v(" webpack")]),a._v(" "),e("h3",{attrs:{id:"热更新"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#热更新"}},[a._v("#")]),a._v(" 热更新")]),a._v(" "),e("p",[a._v("1、启动node层的dev服务，并在web页面注入自己的entry脚本，用于启动websocket连接等")]),a._v(" "),e("p",[a._v("2、编译模块为立即执行函数，保留模块的文件hash和模块间依赖关系图，监听文件变化")]),a._v(" "),e("p",[a._v("3、文件变化时重新计算hash并对比，替换变化模块，重新执行模块函数以及其关联依赖")]),a._v(" "),e("h3",{attrs:{id:"优化构建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优化构建"}},[a._v("#")]),a._v(" 优化构建")]),a._v(" "),e("h4",{attrs:{id:"体积优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#体积优化"}},[a._v("#")]),a._v(" 体积优化")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("懒加载：只加载当前界面需要的代码，可以结合预加载来优化等待时间，合理利用动态import。")])]),a._v(" "),e("li",[e("p",[a._v("按需加载：只加载依赖库用到的模块，而非加载整个库，比如antd结合plugin-import、moment只加载需要的语言库等。")])]),a._v(" "),e("li",[e("p",[a._v("treeshaking：webpack内置优化，构建时丢弃模块未被使用的代码，但需要满足模块代码干净无副作用，比如加载第三方库时指定加载其es版本，更利于webpack做treeshaking优化。")])]),a._v(" "),e("li",[e("p",[a._v("代码压缩：webpack已在生产模式内置，比如uglifyjs。")])]),a._v(" "),e("li",[e("p",[a._v("分离CSS：把样式独立到css文件，或者异步加载，不阻塞js执行。")])]),a._v(" "),e("li",[e("p",[a._v("chunk粒度权衡：将多个异步模块共用的依赖提取出来，统一加载，就可以不必在每个异步模块中都重复打包这些共用依赖，但要考虑chunk粒度，太粗起不到优化效果，太细会拖慢主模块的加载，合理使用splitchunks配置。")])])]),a._v(" "),e("h4",{attrs:{id:"速度优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#速度优化"}},[a._v("#")]),a._v(" 速度优化")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("loader粒度精细：每一类文件只经过它必须的loader。")])]),a._v(" "),e("li",[e("p",[a._v("多线程编译：webpack5内置的Terser plugin已开启parallel，或者手动使用happypack之类的plugin。")])]),a._v(" "),e("li",[e("p",[a._v("编译缓存：webpack5已经内置了模块缓存策略，或者手动使用cache-loader、dll之类的工具。")])]),a._v(" "),e("li",[e("p",[a._v("（对于ts项目）类型检查放到异步：transpileOnly结合fork-ts-checker-webpack-plugin。")])])]),a._v(" "),e("h4",{attrs:{id:"用户网络资源优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用户网络资源优化"}},[a._v("#")]),a._v(" 用户网络资源优化")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("基于contenthash命名模块：模块内容改变文件名才会改变。")])]),a._v(" "),e("li",[e("p",[a._v("提取公共依赖：将不常变动的第三方库从业务代码中独立成一个模块，这个模块的内容可以比较稳定。")])])]),a._v(" "),e("h2",{attrs:{id:"rollup"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rollup"}},[a._v("#")]),a._v(" rollup")]),a._v(" "),e("p",[a._v("更纯粹的打包工具，适合库而非应用（app）")]),a._v(" "),e("h2",{attrs:{id:"gulp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gulp"}},[a._v("#")]),a._v(" gulp")]),a._v(" "),e("p",[a._v("流式任务")]),a._v(" "),e("h2",{attrs:{id:"babel"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#babel"}},[a._v("#")]),a._v(" babel")]),a._v(" "),e("p",[a._v("和polyfill关系：babel只转语法，polyfill拓展原型和全局对象")]),a._v(" "),e("p",[a._v("原理：text => tokens => ast => ast(transformed) => text")]),a._v(" "),e("h3",{attrs:{id:"babel如何直接运行于浏览器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#babel如何直接运行于浏览器"}},[a._v("#")]),a._v(" babel如何直接运行于浏览器？")]),a._v(" "),e("p",[a._v("以此版本 https://unpkg.com/babel-standalone@6.26.0/babel.js 的babel为例：")]),a._v(" "),e("ol",[e("li",[a._v("监听"),e("code",[a._v("DOMContentLoaded")]),a._v("事件，事件触发后会选取所有"),e("code",[a._v("type")]),a._v("为"),e("code",[a._v("text/jsx")]),a._v("和"),e("code",[a._v("text/babel")]),a._v("的"),e("code",[a._v("script")]),a._v("存入jsxScripts数组。")]),a._v(" "),e("li",[a._v("遍历数组，将"),e("code",[a._v("scriptEl.innerHTML")]),a._v("作为源码调用babel核心方法编译为结果代码（带"),e("code",[a._v("src")]),a._v("的"),e("code",[a._v("script")]),a._v("用ajax异步获取content作为源码，在回调中处理编译）。")]),a._v(" "),e("li",[a._v("编译完成后新建"),e("code",[a._v("script")]),a._v("元素，将"),e("code",[a._v("scriptEl.text")]),a._v("设置为结果代码，"),e("code",[a._v("append")]),a._v("到"),e("code",[a._v("headEl")]),a._v("，此时浏览器会自动执行该"),e("code",[a._v("script")]),a._v("。")])])])}),[],!1,null,null,null);t.default=_.exports}}]);