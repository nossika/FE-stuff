import{_ as e,M as o,p as c,q as i,R as s,t as n,N as t,a1 as p}from"./framework-5866ffd3.js";const l={},u=p('<h1 id="v8-å¼•æ“" tabindex="-1"><a class="header-anchor" href="#v8-å¼•æ“" aria-hidden="true">#</a> V8 å¼•æ“</h1><h2 id="v8-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#v8-æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> V8 æ˜¯ä»€ä¹ˆ</h2><p>JS æœ‰ ECMA æ ‡å‡†æ¥æŒ‡å¼•å®ƒçš„ä¸€ç³»åˆ—æ ‡å‡†è¡Œä¸ºï¼Œæ¯”å¦‚æ¨¡å—åŠ è½½è§„èŒƒã€å¼‚æ­¥äº‹ä»¶æµç¨‹ã€å„ API ä¸åŒè¾“å…¥ä¸‹çš„è¡¨ç°ç­‰ã€‚ä½†å¦‚ä½•å®ç° JS çš„æ ‡å‡†è¡Œä¸ºï¼Œåˆ™ç”± JS è¿è¡Œçš„å®¿ä¸»å®ç°ï¼Œå®¿ä¸»ä¸­ç®¡ç†å’Œæ‰§è¡Œ JS çš„æ¨¡å—ç§°ä¸º JS å¼•æ“ï¼Œè€Œ V8 åˆ™æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œå…¶ä»– JS å¼•æ“è¿˜æœ‰ Rhinoã€JavaScriptCoreã€Chakra ç­‰ã€‚</p><p>V8 æ˜¯ google å¼€æºçš„ JS å¼•æ“ï¼Œç”± C++ ç¼–å†™ï¼Œè¢«åº”ç”¨äº Chromeã€NodeJS ç­‰åº”ç”¨ï¼Œæ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„ JS å¼•æ“ã€‚</p><h2 id="æŸ¥é˜…-v8-æºç " tabindex="-1"><a class="header-anchor" href="#æŸ¥é˜…-v8-æºç " aria-hidden="true">#</a> æŸ¥é˜… V8 æºç </h2>',5),r={href:"https://github.com/v8/v8",target:"_blank",rel:"noopener noreferrer"},d=s("h3",{id:"js-api-å¯¹åº”çš„æºç ",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#js-api-å¯¹åº”çš„æºç ","aria-hidden":"true"},"#"),n(" JS API å¯¹åº”çš„æºç ")],-1),k={href:"https://github.com/v8/v8/tree/14bc07d1427de50421a672cfac5ded5ae2ee7bda/src/builtins",target:"_blank",rel:"noopener noreferrer"},m={href:"https://github.com/v8/v8/blob/14bc07d1427de50421a672cfac5ded5ae2ee7bda/src/builtins/array-map.tq#L227",target:"_blank",rel:"noopener noreferrer"},v={href:"https://tc39.github.io/ecma262/#sec-array.prototype.map",target:"_blank",rel:"noopener noreferrer"},b={href:"https://github.com/v8/v8/tree/14bc07d1427de50421a672cfac5ded5ae2ee7bda/src/torque",target:"_blank",rel:"noopener noreferrer"},h=s("h3",{id:"mac-æ­å»ºè°ƒè¯•ç¯å¢ƒ",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#mac-æ­å»ºè°ƒè¯•ç¯å¢ƒ","aria-hidden":"true"},"#"),n(" Mac æ­å»ºè°ƒè¯•ç¯å¢ƒ")],-1),g={href:"https://v8.dev/docs/source-code",target:"_blank",rel:"noopener noreferrer"},f={href:"https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up",target:"_blank",rel:"noopener noreferrer"},_=p(`<p>2ã€å®‰è£… v8ï¼Œå…³è”ä¾èµ–</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> depot_tools
$ fetch v8
$ gclient <span class="token function">sync</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3ã€ç¼–è¯‘</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> depot_tools/v8
$ tools/dev/gm.py arm64
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–è¯‘äº§ç‰©é»˜è®¤åœ¨ <code>out/</code> ä¸­ï¼Œå¯ç”¨ <code>out/arm64.release/d8</code> æ‰§è¡Œ JS è„šæœ¬ã€‚</p><p>4ã€è¾“å‡º xcode æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> depot_tools/v8
$ gn gen out/gn <span class="token parameter variable">--ide</span><span class="token operator">=</span><span class="token string">&quot;xcode&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºçš„æ–‡ä»¶åœ¨ <code>out/gn</code>ã€‚</p><p>5ã€ä½¿ç”¨ xcode è°ƒè¯•</p><p>ç”¨ xcode æ‰“å¼€ä¸Šä¸€æ­¥è¾“å‡ºçš„ <code>out/gn/all.xcodeproj</code> æ–‡ä»¶ã€‚</p><p>xcode å·¥å…·æ  product -&gt; scheme -&gt; d8ï¼Œå¯åŠ¨ç¼–è¯‘å¹¶è¿è¡Œã€‚</p><p>ç­‰å¾…ç¼–è¯‘æˆåŠŸåï¼Œå³å¯åœ¨ xcode ä¸­çš„å‘½ä»¤è¡Œæ‰§è¡Œ JS è„šæœ¬ï¼Œå¹¶ä¸”å¯ä»¥ç”¨ xcode åœ¨ v8 æºç æ–­ç‚¹è°ƒè¯•ã€‚</p><h2 id="è°ƒè¯•-v8" tabindex="-1"><a class="header-anchor" href="#è°ƒè¯•-v8" aria-hidden="true">#</a> è°ƒè¯• V8</h2>`,13),y={href:"https://github.com/v8/v8/blob/master/src/runtime/runtime.h",target:"_blank",rel:"noopener noreferrer"},j=s("p",null,[n("å¯¹äºä»¥ V8 å¼•æ“å®ç°çš„åº”ç”¨ï¼ŒåŠ ä¸Š"),s("code",null,"--allow-natives-syntax"),n("å¯åŠ¨å‚æ•°å³å¯å…è®¸è°ƒè¯•ã€‚")],-1),x=s("ul",null,[s("li",null,[n("node å¯ä»¥é€šè¿‡"),s("code",null,"node --allow-natives-syntax"),n("å‘½ä»¤æ‰§è¡Œç¨‹åº")]),s("li",null,[n("chromium å¯ä»¥é€šè¿‡"),s("code",null,'open -a Chromium --args --js-flags="--allow-natives-syntax"'),n("å¯åŠ¨")])],-1),E={href:"https://github.com/GoogleChromeLabs/jsvu",target:"_blank",rel:"noopener noreferrer"},S=p('<h2 id="jit-just-in-time-ç¼–è¯‘ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#jit-just-in-time-ç¼–è¯‘ä¼˜åŒ–" aria-hidden="true">#</a> JITï¼ˆJust-In-Timeï¼‰ç¼–è¯‘ä¼˜åŒ–</h2><h3 id="è§£é‡Šæ‰§è¡Œ-js-è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#è§£é‡Šæ‰§è¡Œ-js-è¿‡ç¨‹" aria-hidden="true">#</a> è§£é‡Šæ‰§è¡Œ JS è¿‡ç¨‹</h3><p>JS æ˜¯éç¼–è¯‘å‹è¯­è¨€ï¼Œå…¶è¿è¡Œæ˜¯ç›´æ¥æ‰§è¡Œæºç ï¼Œè¿è¡Œæ—¶åœ¨ JS å¼•æ“å†…éƒ¨å®ç°â€æºç  -&gt; AST -&gt; å­—èŠ‚ç  -&gt; æ±‡ç¼–ï¼ˆæœºå™¨ç ï¼‰â€œç¼–è¯‘è¿‡ç¨‹ã€‚</p><p>ä½†å¦‚æœåœ¨è¿è¡Œå‰ï¼Œå°±å¯¹å…¨éƒ¨ä»£ç æ‰§è¡Œä¸Šè¿°ç¼–è¯‘è¿‡ç¨‹ï¼Œä¼šå ç”¨è¾ƒé•¿æ—¶é—´ï¼Œä¸”éœ€è¦è¾ƒå¤§å†…å­˜æ¥ä¿å­˜ç¼–è¯‘åçš„æœºå™¨ç ï¼ˆè¶Šåº•å±‚çš„ä»£ç è¶Šå†—é•¿ï¼‰ã€‚æ‰€ä»¥é€šå¸¸ JS å¼•æ“çš„å®ç°æ˜¯ç¿»è¯‘åˆ°â€œå­—èŠ‚ç â€è¿™ä¸€å±‚ï¼Œç„¶åè¾¹è¿è¡Œè¾¹ç¿»è¯‘æˆâ€œæœºå™¨ç â€æ¥æ‰§è¡Œã€‚</p><h3 id="é¢„ç¼–è¯‘-turbofan" tabindex="-1"><a class="header-anchor" href="#é¢„ç¼–è¯‘-turbofan" aria-hidden="true">#</a> é¢„ç¼–è¯‘ï¼ˆTurboFanï¼‰</h3><p>V8 å¼•æ“å¯¹è¿™ä¸ªè¿‡ç¨‹åšäº† JIT ä¼˜åŒ–ï¼Œå³é€‚æ—¶å°†æŸäº›è¾ƒå¸¸è¿è¡Œçš„â€œå­—èŠ‚ç â€ä¼˜åŒ–å¹¶ç¼“å­˜ï¼Œçœå»åç»­çš„ç¼–è¯‘è€—æ—¶ã€‚</p><p>åœ¨ V8 ä¸­ï¼Œè§£é‡Šæ‰§è¡Œâ€œå­—èŠ‚ç â€çš„æ¨¡å—æ˜¯ Ignitionï¼Œå®ƒåœ¨è§£é‡Šæ‰§è¡Œâ€œå­—èŠ‚ç â€çš„åŒæ—¶ï¼Œä¹ŸæŒç»­ç›‘æ§å‡½æ•°è°ƒç”¨æƒ…å†µï¼Œå½“æŸä¸ªå‡½æ•°è¢«é«˜é¢‘è°ƒç”¨ä¸”å‚æ•°ç±»å‹ä¹Ÿç¨³å®šï¼Œå®ƒä¼šè®¤ä¸ºè¿™æ®µâ€œå­—èŠ‚ç â€æœ‰ä¼˜åŒ–å¿…è¦ï¼Œä¼šå°†å…¶ä¼˜åŒ–å¹¶ç¼“å­˜ä¼˜åŒ–ç»“æœä¾›åç»­ä½¿ç”¨ã€‚</p><p>V8 åˆæ­¥ä¼˜åŒ–â€œå­—èŠ‚ç â€çš„åŠ¨ä½œå« Baselineï¼Œå®ƒä¼šå°è¯•å°†â€œå­—èŠ‚ç â€æŒ‰å›ºå®šå‚æ•°ç±»å‹ä¼˜åŒ–ï¼Œäº§ç‰©è¿˜æ˜¯â€œå­—èŠ‚ç â€ï¼Œä½†æ‰§è¡Œé€Ÿåº¦ç›¸æ¯”â€œåŸå§‹å­—èŠ‚ç â€œè¦å¿«äº›ã€‚</p>',8),M={href:"https://github.com/v8/v8/blob/c8fad7737ced5c262dee11610164f27a8ca155fe/src/runtime/runtime.h#L1019",target:"_blank",rel:"noopener noreferrer"},P=s("p",null,"å¯¹äºç¼–å†™ä»£ç çš„å‚è€ƒæ„ä¹‰æ˜¯ï¼šå¯¹äºçƒ­ç‚¹ä»£ç ç‰‡æ®µï¼Œå¯å°†å…¶æŠ½ç¦»æˆç‹¬ç«‹å‡½æ•°ï¼Œå¹¶ä½¿å…¶å…¥å‚ç±»å‹ä¿æŒç¨³å®šã€‚è¿™æ ·æ‰èƒ½æœ€å¤§åŒ–åˆ©ç”¨ JIT çš„ä¼˜åŒ–ã€‚",-1),w=s("code",null,"%GetOptimizationStatus",-1),F={href:"https://github.com/v8/v8/blob/c8fad7737ced5c262dee11610164f27a8ca155fe/src/runtime/runtime.h#L1012",target:"_blank",rel:"noopener noreferrer"},V=s("code",null,"100001",-1),J=p(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token function">GetOptimizationStatus</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 --- åˆå§‹çŠ¶æ€ï¼Œæ— ä¼˜åŒ–</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token function">GetOptimizationStatus</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100000000000001 --- Baseline ä¼˜åŒ–</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token function">GetOptimizationStatus</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 110001 --- TurboFan ä¼˜åŒ–</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token function">GetOptimizationStatus</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 --- å›é€€åˆ°æ— ä¼˜åŒ–</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç ´åä¼˜åŒ–çš„ä¸€ä¸ªä¾‹å­ï¼ŒåŒæ ·çš„ä¸¤æ®µé€»è¾‘ï¼Œç ´åä¼˜åŒ–åæ‰§è¡Œæ•ˆç‡ä¼šæ˜¾è‘—é™ä½ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&#39;loop 1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&#39;loop 1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 477.609ms</span>

<span class="token comment">// ç ´åå…¥å‚ç¨³å®šæ€§ï¼Œå›é€€åˆ°æ— ä¼˜åŒ–çŠ¶æ€</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&#39;loop 2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&#39;loop 2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2.044s</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å¯¹è±¡æˆå‘˜çš„å­˜å‚¨ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡æˆå‘˜çš„å­˜å‚¨ä¼˜åŒ–" aria-hidden="true">#</a> å¯¹è±¡æˆå‘˜çš„å­˜å‚¨ä¼˜åŒ–</h2><h3 id="æˆå‘˜åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#æˆå‘˜åˆ†ç±»" aria-hidden="true">#</a> æˆå‘˜åˆ†ç±»</h3><p>å› ä¸º JS é‡Œå®ç°åŒä¸€ç±»å¯¹è±¡çš„æ‰‹æ®µæ˜¯â€åŸå‹â€œï¼Œæ²¡æœ‰ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ç±»ï¼Œä¸”å¯¹è±¡æˆå‘˜ï¼ˆç”šè‡³å…¶åŸå‹ï¼‰å¯ä»¥åœ¨è¿è¡Œæ—¶å˜åŒ–ï¼Œæ‰€ä»¥æ— æ³•åœ¨ç¼–è¯‘æ—¶å°±ä¸ºå¯¹è±¡åˆ†é…å¥½å›ºå®šçš„ç©ºé—´ã€‚æ‰€ä»¥åªèƒ½åœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€ä¸ºå¯¹è±¡æ¯ä¸ªæˆå‘˜åˆ†é…ç©ºé—´ï¼Œæ‰€ä»¥è®¿é—®å¯¹è±¡æˆå‘˜å°±æœ‰äº†ä½ç½®æŸ¥æ‰¾çš„æ¶ˆè€—ã€‚</p><p>V8 çš„å¯¹è±¡ä»¥ 3 ç±»ç»“æ„æ¥å­˜å‚¨æˆå‘˜æ•°æ®</p><ul><li>elements: ç´¢å¼•å±æ€§ï¼Œä»¥æ•°å­—ä¸ºä¸‹æ ‡çš„æˆå‘˜</li><li>properties: å‘½åå±æ€§ï¼Œä»¥å¸¸è§„å­—ç¬¦ä¸²å‘½åçš„æˆå‘˜</li><li>inline-object properties: ç›´æ¥å­˜å‚¨äºå¯¹è±¡æœ¬èº«ï¼Œçº¿æ€§ç©ºé—´ï¼ŒæŸ¥æ‰¾æ›´å¿«ï¼Œä½†ä»…èƒ½å­˜ä¸‹å°‘é‡æ•°æ®ï¼Œæœ‰è¾ƒå¤šé™åˆ¶ã€‚æ— æ³•ä½¿ç”¨ inline-object properties å°±ä¼šè‡ªåŠ¨è½¬å­˜ properties</li></ul><blockquote><p>éå†å¯¹è±¡çš„æˆå‘˜æ—¶ï¼ˆæ¯”å¦‚<code>Object.keys(obj)</code>ï¼‰ï¼ŒECMA æ ‡å‡†è§„å®šä¸€å®šæ˜¯å…ˆéå† elementsï¼Œå¹¶ä¸”ä»¥æ•°å­—å‡åºé¡ºåºéå†ï¼Œå†éå† propertiesï¼ŒæŒ‰å£°æ˜é¡ºåºéå†ã€‚</p></blockquote><h3 id="éšè—ç±»-hiddenclass" tabindex="-1"><a class="header-anchor" href="#éšè—ç±»-hiddenclass" aria-hidden="true">#</a> éšè—ç±»ï¼ˆHiddenClassï¼‰</h3><p>å¯¹äº properties æ•°æ®ï¼Œå…¶å­˜å‚¨æ˜¯è¯å…¸ç»“æ„ï¼ŒæŸ¥æ‰¾æˆå‘˜æœ‰ä¸€å®šæ¶ˆè€—ï¼Œå¯¹äºåŒä¸€ç±»å¯¹è±¡çš„æˆå‘˜ä½ç½®æ˜¯å›ºå®šçš„ï¼Œæ¯æ¬¡éƒ½æ‰§è¡Œè¿™æ ·çš„æŸ¥æ‰¾æœ‰ç‚¹å¤šä½™ã€‚å¦‚æœèƒ½æœ‰ä¸ªç¼“å­˜æ¥è®°ä½æ¯ä¸ªæˆå‘˜çš„ä½ç½®å°±å¥½äº†ã€‚</p><p>V8 ä¸ºæ¯ä¸ªå¯¹è±¡åˆ›é€ äº†â€œéšè—ç±»â€ï¼Œâ€œéšè—ç±»â€ä¸­ä¿å­˜äº† keyï¼ˆæˆå‘˜å‘½åï¼‰å’Œå…¶å¯¹åº”çš„å†…å­˜åç§»å€¼ï¼ŒçŸ¥é“ key å°±èƒ½ç›´æ¥æ ¹æ®å†…å­˜åç§»å€¼å–åˆ°æ•°æ®ã€‚å¯¹äºæœ‰ç›¸åŒâ€œéšè—ç±»â€çš„å¯¹è±¡ï¼Œå…¶å–å€¼å¯çœå»ä¸€æ¬¡æŸ¥æ‰¾çš„è¿‡ç¨‹ã€‚â€œéšè—ç±»â€æœ¬èº«æ˜¯çº¿æ€§ç©ºé—´ï¼Œç¼–è¯‘æœŸ V8 ä¼šæŠŠå¯¹è±¡çš„ key ç¼–è¯‘ä¸ºç´¢å¼•ï¼Œä¸â€œéšè—ç±»â€çš„çº¿æ€§ç»“æ„å…³è”ï¼Œæ‰€ä»¥å¯¹â€œéšè—ç±»â€æœ¬èº«çš„è®¿é—®æå¿«ã€‚</p><p>éšè—ç±»æ˜¯æœ‰åºåˆ›å»ºçš„ï¼Œæ¯”å¦‚å¯¹äºåŒæ ·çš„ä¸€ä¸ªåˆå§‹å¯¹è±¡ï¼Œå…ˆèµ‹å€¼ a å†èµ‹å€¼ bï¼Œå’Œå…ˆèµ‹å€¼ b å†èµ‹å€¼ aï¼Œä¸¤è€…æœ€ç»ˆå¾—åˆ°çš„éšè—ç±»æ˜¯ä¸åŒçš„ã€‚</p><p>å¯¹äºç¼–å†™ä»£ç çš„å‚è€ƒæ„ä¹‰æ˜¯ï¼šå¯¹äºåŒä¸€ç±»å¯¹è±¡ï¼Œæˆå‘˜å£°æ˜é¡ºåºåº”ä¿æŒç¨³å®šï¼Œå¦‚æœæœ‰ç©ºå€¼ä¹Ÿæ˜¾å¼ç”¨ undefined å£°æ˜ã€‚è¿™æ ·æ‰èƒ½å°½å¯èƒ½åˆ©ç”¨éšè—ç±»ã€‚</p><p>å¯ä»¥æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼Œè§‚å¯Ÿéšè—ç±»ï¼ˆ<code>%DebugPrint</code> è¿”å›çš„ map åœ°å€ï¼‰çš„å¤ç”¨æƒ…å†µï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;a -&gt; b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj1<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// ç”Ÿæˆéšè—ç±» Map(a)</span>
obj1<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// ç”Ÿæˆéšè—ç±» Map(a, b)</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// - map: 0x28d5385b7599 &lt;Map(HOLEY_ELEMENTS)&gt; [FastProperties]</span>



console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;b -&gt; a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj2<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// ç”Ÿæˆéšè—ç±» Map(b)</span>
obj2<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// ç”Ÿæˆéšè—ç±» Map(b, a)</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// map: 0x36c5d97f7629 &lt;Map(HOLEY_ELEMENTS)&gt; [FastProperties]</span>



console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;a -&gt; b -&gt; c&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj3 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj3<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
obj3<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// ğŸŒŸ å¤ç”¨å‰é¢çš„ Map(a, b)</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>obj3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// - map: 0x28d5385b7599 &lt;Map(HOLEY_ELEMENTS)&gt; [FastProperties]</span>

obj3<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">// åŸºäºå‰é¢çš„ Map(a, b) æ‹“å±•å‡ºæ–°çš„ Map(a, b, c)</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>obj3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// - map: 0x28d5385b7671 &lt;Map(HOLEY_ELEMENTS)&gt; [FastProperties]</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;a -&gt; c vs a -&gt; b -&gt; c&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj4 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj4<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
obj4<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">// ç”Ÿæˆéšè—ç±» Map(a, c)</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>obj4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// - map: 0x36c5d97f76b9 &lt;Map(HOLEY_ELEMENTS)&gt; [FastProperties]</span>

<span class="token keyword">const</span> obj5 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
obj5<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
obj5<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
obj5<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">// ğŸŒŸ å¤ç”¨å‰é¢çš„ Map(a, b, c)</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>obj5<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// - map: 0x36c5d97f7671 &lt;Map(HOLEY_ELEMENTS)&gt; [FastProperties]</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;a + b vs b + a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj6 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// ç”Ÿæˆéšè—ç±» Map(ab)</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>obj6<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// - map: 0x36c5d97f7749 &lt;Map(HOLEY_ELEMENTS)&gt; [FastProperties]</span>

<span class="token keyword">const</span> obj7 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// ç”Ÿæˆéšè—ç±» Map(ba)</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>obj7<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// - map: 0x36c5d97f77d9 &lt;Map(HOLEY_ELEMENTS)&gt; [FastProperties]</span>

<span class="token keyword">const</span> obj8 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// ğŸŒŸ å¤ç”¨éšè—ç±» Map(ab)</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>obj8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// - map: 0x36c5d97f7749 &lt;Map(HOLEY_ELEMENTS)&gt; [FastProperties]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥åœ¨ chrome çš„ memory æŠ“å–å†…å­˜å¿«ç…§ï¼ŒæŸ¥çœ‹å¯¹è±¡çš„ç»“æ„ï¼Œå…¶ä¸­<code>system / Map</code>æŒ‡å‘çš„å°±æ˜¯å…¶éšè—ç±»ã€‚</p><h3 id="å¿«å±æ€§-fastproperties" tabindex="-1"><a class="header-anchor" href="#å¿«å±æ€§-fastproperties" aria-hidden="true">#</a> å¿«å±æ€§ï¼ˆFastPropertiesï¼‰</h3><p>åœ¨<a href="#%E6%88%90%E5%91%98%E5%88%86%E7%B1%BB">æˆå‘˜åˆ†ç±»</a>ä¸­æœ‰æåˆ°ï¼Œå¯¹è±¡çš„å‘½åæˆå‘˜å¯èƒ½ä¼šè¢«å­˜å‚¨åˆ° properties æˆ–è€… inline-object propertiesï¼Œå½“æˆå‘˜éƒ½è¢«å­˜å‚¨åˆ° inline-object properties æ—¶ï¼Œå³ç§°è¿™ä¸ªå¯¹è±¡æ‹¥æœ‰â€œå¿«å±æ€§â€ã€‚</p><p>â€œå¿«å±æ€§â€æ˜¯ä»¥çº¿æ€§ç©ºé—´å­˜å‚¨ï¼Œç›´æ¥å¯é€šè¿‡ç´¢å¼•è®¿é—®ï¼Œå› æ­¤è®¿é—®æœ€å¿«ã€‚é€šå¸¸å¯¹å¯¹è±¡æˆå‘˜çš„åˆ é™¤æ“ä½œä¼šç ´åè¿™ä¸ªçº¿æ€§ç©ºé—´ï¼Œæ­¤æ—¶ V8 ä¼šæŠŠæˆå‘˜å…¨éƒ¨è½¬å­˜åˆ° properties ä¸­ï¼Œå¯¼è‡´æŸ¥æ‰¾å˜æ…¢ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼Œé€šè¿‡<code>%HasFastProperties</code>è¿½è¸ªæ­¤æ—¶å¯¹è±¡æ˜¯å¦å…·æœ‰â€œå¿«å±æ€§â€ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token function">HasFastProperties</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true - ç®€å•å¯¹è±¡åˆå§‹æ‹¥æœ‰å¿«å±æ€§</span>

obj<span class="token punctuation">.</span>xxx <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&#39;loop 1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>c<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&#39;loop 1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 49.585ms</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token function">HasFastProperties</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true - å¢åŠ ä¸€ä¸ªæˆå‘˜åï¼Œä¾ç„¶æ‹¥æœ‰å¿«å±æ€§</span>

Reflect<span class="token punctuation">.</span><span class="token function">deleteProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token function">HasFastProperties</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false - åˆ é™¤ä¸€ä¸ªæˆå‘˜åï¼Œç ´åå¿«å±æ€§</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&#39;loop 2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>c<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&#39;loop 2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 472.515ms</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¿«æ•°ç»„-fixedarray" tabindex="-1"><a class="header-anchor" href="#å¿«æ•°ç»„-fixedarray" aria-hidden="true">#</a> å¿«æ•°ç»„ï¼ˆFixedArrayï¼‰</h3><p>JS ä¸­çš„æ•°ç»„å…¶å®ä¹Ÿæ˜¯å¯¹è±¡çš„ä¸€ç§ç‰¹æ®Šè¡¨ç°å½¢å¼ï¼Œå…¶ä¸»è¦ä½¿ç”¨å¯¹è±¡çš„ elements ç»“æ„æ¥å­˜å‚¨æ•°ç»„æ•°æ®ã€‚</p><p>V8 å†…éƒ¨çš„æ•°ç»„æœ‰ä¸¤ç§æ¨¡å¼</p><ul><li><p>FixedArrayï¼šå¿«æ•°ç»„ï¼Œä»¥ç±»ä¼¼ä¼ ç»Ÿæ•°ç»„çš„ç»“æ„å­˜å‚¨æˆå‘˜ï¼Œæœ‰è¿ç»­çš„ç©ºé—´ï¼Œé€šè¿‡ç´¢å¼•æŸ¥æ‰¾æå¿«</p></li><li><p>HashTableï¼šæ…¢æ•°ç»„ï¼Œä»¥å­—å…¸è¡¨çš„ç»“æ„å­˜å‚¨æˆå‘˜ï¼Œç´¢å¼•ä»…æ˜¯å­—å…¸çš„é”®ï¼ŒæŸ¥æ‰¾æœ‰ä¸€å®šæ¶ˆè€—</p></li></ul><p>V8 ä¼šå°½é‡åœ°ä»¥â€œå¿«æ•°ç»„â€çš„æ¨¡å¼å®ç°æ•°ç»„ï¼Œä½†å¦‚æœæ•°ç»„å¹¶éç´§å¯†æ’åˆ—ï¼Œåˆ™å…¶å¯èƒ½ä¼šé™çº§ä¸ºâ€œæ…¢æ•°ç»„â€æ¨¡å¼ï¼Œä»¥èŠ‚çœä¸å¿…è¦çš„ç©ºé—´å ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// åˆ†é…é•¿åº¦ä¸º 3 çš„ FixedArray</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// - elements: 0x1e013b9910e1 &lt;FixedArray[3]&gt;</span>

arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åŠ å…¥ä¸¤ä¸ªæˆå‘˜ï¼Œå¹¶è‡ªåŠ¨é¢„æ‰©å®¹ä¸º 23 çš„ FixedArrayï¼Œå‰©ä¸‹éƒ¨ä»½ç•™ç©ºå¤‡ç”¨</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// - elements: 0x250961a49611 &lt;FixedArray[23]&gt; ... 5-22: 0x20b7a4681669 &lt;the_hole&gt;</span>

arr<span class="token punctuation">[</span><span class="token number">2000</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span> <span class="token comment">// è½¬åŒ–ä¸ºç¨€ç–æ•°ç»„ï¼Œä»¥ NumberDictionary ç»“æ„å­˜å‚¨</span>
<span class="token operator">%</span><span class="token function">DebugPrint</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// - elements: 0x250961a497c9 &lt;NumberDictionary[52]&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è‡ªåŠ¨åƒåœ¾å›æ”¶-garbage-collection" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨åƒåœ¾å›æ”¶-garbage-collection" aria-hidden="true">#</a> è‡ªåŠ¨åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰</h2><p>V8é‡‡ç”¨äº†åˆ†ä»£ GCï¼Œå°†å†…å­˜åˆ’åˆ†ä¸ºï¼š</p><ul><li>æ–°ç”Ÿä»£åŒºï¼šå¤§éƒ¨åˆ†å¯¹è±¡åœ¨æ­¤åŒºï¼ŒåŒºåŸŸå°ä½†åƒåœ¾å›æ”¶é¢‘ç¹</li><li>è€ç”Ÿä»£åŒºï¼šä»æ–°ç”Ÿä»£æ™‹å‡è€Œæ¥çš„ç”Ÿå­˜å‘¨æœŸé•¿çš„å¯¹è±¡</li><li>å¤§å¯¹è±¡åŒºï¼šå ç”¨ç©ºé—´è¾ƒå¤§çš„å¯¹è±¡</li><li>ä»£ç åŒºï¼šå”¯ä¸€æ‹¥æœ‰æ‰§è¡Œæƒé™çš„åŒºåŸŸ</li></ul><h3 id="æ–°ç”Ÿä»£åŒº" tabindex="-1"><a class="header-anchor" href="#æ–°ç”Ÿä»£åŒº" aria-hidden="true">#</a> æ–°ç”Ÿä»£åŒº</h3><p>é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼ˆscavengeï¼‰åšåƒåœ¾å›æ”¶ï¼ˆGCï¼‰</p><p>å†…å­˜ç©ºé—´åˆ†ä¸ºä¸¤åŠ---fromåŒºå’ŒtoåŒºï¼ŒfromåŒºæ˜¯å¤„äºä½¿ç”¨çŠ¶æ€çš„å†…å­˜ï¼Œæ–°å¯¹è±¡éƒ½ä¼šåˆ†é…åˆ°fromåŒºï¼Œå½“GCå¼€å§‹æ—¶ï¼ˆå¦‚fromåŒºå­˜æ»¡æ—¶ï¼‰ï¼Œå¼•æ“ä¼šæ‰«æå‡ºæ´»è·ƒå¯¹è±¡ï¼ˆä»rootå¼€å§‹æ‰«æï¼Œä»rootä½œBFSéå†å…¶èƒ½è®¿é—®çš„æ‰€æœ‰å¯¹è±¡ï¼‰ï¼Œå¤åˆ¶åˆ°toåŒºï¼Œè¿™æ ·toåŒºå°±éƒ½ä¸ºæ´»è·ƒå¯¹è±¡ï¼Œç„¶åäº¤æ¢fromåŒºå’ŒtoåŒºå†…å®¹ï¼Œé‡Šæ”¾toåŒºã€‚</p><p>ç”±äºæ­¤åŒºå¤§éƒ¨åˆ†å¯¹è±¡æ˜¯éæ´»è·ƒï¼Œæ‰€ä»¥å¤åˆ¶æ“ä½œä»£ä»·å°ï¼Œç©ºé—´ä¸Šæœ‰ä¸€åŠæ˜¯å¤„äºç©ºç½®çŠ¶æ€ï¼ˆtoåŒºï¼‰ï¼Œä½†å› ä¸ºæ­¤åŒºç©ºé—´æœ¬èº«å°±å°ï¼Œæ‰€ä»¥å¯ä»¥æ¥å—è¿™ç§ç©ºç½®ï¼Œç‰ºç‰²ç©ºé—´å¸¦æ¥çš„å¥½å¤„æ˜¯åªéœ€è¦ä½œä¸€æ¬¡å¤åˆ¶éå†ï¼Œè€Œä¸ç”¨è¿›è¡Œæ ‡è®°+æ¸…é™¤ä¸¤æ¬¡éå†ã€‚</p><p>å½“æ­¤åŒºçš„å¯¹è±¡ç»è¿‡å¤šæ¬¡GCä¾ç„¶å­˜æ´»ï¼Œè¯´æ˜å…¶ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œå¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°è€ç”Ÿä»£åŒºï¼Œæ­¤è¿‡ç¨‹ç§°ä¸ºå¯¹è±¡æ™‹å‡ã€‚</p><h3 id="è€ç”Ÿä»£åŒº" tabindex="-1"><a class="header-anchor" href="#è€ç”Ÿä»£åŒº" aria-hidden="true">#</a> è€ç”Ÿä»£åŒº</h3><p>é‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆmark-sweepï¼‰åšGC</p><p>ä¸å†é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œå› ä¸ºæ­¤åŒºç©ºé—´è¾ƒå¤§ï¼Œç©ºç½®ä¸€åŠçš„ç©ºé—´å¤ªæµªè´¹ï¼Œä¸”å¤§é‡æ´»è·ƒå¯¹è±¡çš„å¤åˆ¶ä»£ä»·å¤§ã€‚æ­¤ç®—æ³•é‡‡ç”¨DFSéå†æ¥æ ‡è®°æ´»è·ƒå¯¹è±¡ï¼Œæ ‡è®°ç»“æŸåå°†éæ´»è·ƒå¯¹è±¡ï¼ˆæœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼‰ç›´æ¥æ¸…é™¤ã€‚</p><p>æ ‡è®°-æ¸…é™¤æ“ä½œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼ˆå†…å­˜ç©ºé—´ä¸è¿ç»­ï¼‰ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶æ‰§è¡Œæ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆmark-compactï¼‰æ¥æ•´ç†å†…å­˜ã€‚</p>`,40);function L(T,C){const a=o("ExternalLinkIcon");return c(),i("div",null,[u,s("p",null,[n("V8 æºç ä»“åº“ï¼š"),s("a",r,[n("https://github.com/v8/v8"),t(a)])]),d,s("p",null,[n("JS å¤§éƒ¨åˆ†å†…ç½®çš„ API å®ç°éƒ½åœ¨ "),s("a",k,[n("/src/builtins"),t(a)]),n(" ç›®å½•å†…ï¼Œå¯é€šè¿‡ API åæœç´¢åˆ°æºç ã€‚")]),s("p",null,[n("æ¯”å¦‚æ•°ç»„çš„ map æ–¹æ³•ï¼Œå¯ä»¥ç”¨ Array.prototype.map å…³é”®å­—æœç´¢ï¼Œæ‰¾åˆ°å…¶æºç ä½äº "),s("a",m,[n("/src/builtins/array-map.tq"),t(a)]),n("ï¼Œæ³¨é‡Šå¤„é™„æœ‰å¯¹åº”çš„ ecma çš„æ ‡å‡†æ–‡ä»¶ "),s("a",v,[n("sec-array.prototype.map"),t(a)]),n("ã€‚")]),s("p",null,[n("å…¶ä¸­ .tq ç»“å°¾çš„æ–‡ä»¶æ˜¯ä»¥ Torque è¯­è¨€ç¼–å†™ï¼ˆä¸€ç§ V8 å†…éƒ¨çš„ DSLï¼‰ï¼Œå®é™…æ„å»ºæ—¶ä¼šå…ˆè¢« "),s("a",b,[n("Torque ç¼–è¯‘å™¨"),t(a)]),n(" è½¬åŒ–ä¸º C++ ä»£ç ï¼Œå†æœ€ç»ˆç¼–è¯‘ä¸ºäºŒè¿›åˆ¶çš„æœºå™¨ç ã€‚")]),h,s("p",null,[n("å‚è€ƒ v8 å®˜æ–¹æŒ‡å¼•ï¼š"),s("a",g,[n("https://v8.dev/docs/source-code"),t(a)])]),s("p",null,[n("1ã€ä¸‹è½½è°ƒè¯•å·¥å…· "),s("a",f,[n("depot_tools"),t(a)])]),_,s("p",null,[n("V8 åŸç”Ÿæä¾›äº† debug APIï¼Œ"),s("a",y,[n("runtime.h"),t(a)]),n("ä¸­åˆ—å‡ºäº†æ‰€æœ‰çš„è°ƒè¯•å‘½ä»¤ã€‚")]),j,x,s("p",null,[n("æœ‰ä¸ª "),s("a",E,[n("jsvu"),t(a)]),n(" å¼€æºåº“ï¼Œå¯æ–¹ä¾¿åœ°ä¸‹è½½ä¸åŒ JS å¼•æ“åˆ°æœ¬åœ°è¿›è¡Œè°ƒè¯•ã€‚")]),S,s("p",null,[n("å¦‚æœå‡½æ•°ä¾ç„¶è¢«é«˜é¢‘è°ƒç”¨ä¸”å…¥å‚ç¨³å®šï¼ŒV8 ä¼šå°†å…¶æ›´è¿›ä¸€æ­¥ä¼˜åŒ–ä¸ºâ€æœºå™¨ç â€œï¼Œè´Ÿè´£å°†â€œå­—èŠ‚ç â€ç¼–è¯‘ä¸ºâ€œæœºå™¨ç â€çš„åŠ¨ä½œå«åš TurboFanï¼Œè¢«é¢„ç¼–è¯‘çš„å‡½æ•°ä¼šå¾—åˆ° "),s("a",M,[n("TurboFanned"),t(a)]),n(" çš„çŠ¶æ€ï¼Œè¿™é‡Œç¼–è¯‘åçš„â€œæœºå™¨ç â€å…¶å®è¿˜å¸¦äº†å‰ç½®çš„ã€å¯¹å‡½æ•°å…¥å‚çš„ checkpoint åˆ¤æ–­ã€‚åç»­å‡½æ•°è°ƒç”¨éƒ½ä¼šå°è¯•ç”¨æ­¤æœºå™¨ç æ‰§è¡Œï¼Œä½†å¦‚æœ checkpoint é˜¶æ®µå‘ç°å‡ºç°å…¥å‚ç±»å‹ä¸åŒï¼Œæ— æ³•ç›´æ¥ç”¨æ­¤â€œæœºå™¨ç â€ï¼Œåˆ™ä¼šå›é€€åˆ°â€œåŸå§‹å­—èŠ‚ç â€æ‰§è¡Œã€‚å½“å¤šæ¬¡å‡ºç°è¿™ç§å›é€€ï¼ŒV8 ä¼šæ”¾å¼ƒè¿™ä¸ªç¼–è¯‘ä¼˜åŒ–ã€‚")]),P,s("p",null,[w,n("å¯ä»¥è·å–å‡½æ•°çš„ä¼˜åŒ–çŠ¶æ€ï¼Œå¾—åˆ°ç»“æœæ˜¯ä¸€ä¸ªæœ€å¤š 20 ä½çš„äºŒè¿›åˆ¶æ•°å­—ï¼Œæ¯ä¸€ä½çš„å«ä¹‰å¯å‚è€ƒ V8 æºç çš„ "),s("a",F,[n("OptimizationStatus"),t(a)]),n("ã€‚æ¯”å¦‚ "),V,n(" è¡¨ç¤ºè¿›å…¥äº† TurboFan ä¼˜åŒ–ï¼ˆå€’æ•°ç¬¬ 6 ä½ä¸º 1ï¼‰ã€‚")]),J])}const N=e(l,[["render",L],["__file","engine.html.vue"]]);export{N as default};
